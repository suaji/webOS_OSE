(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1d686bb0"],{"5aac":function(t,e,s){"use strict";var n=s("9028"),r=s.n(n);e["default"]=r.a},9028:function(t,e,s){t.exports={wrapper:"channel_wrapper_2YGWL",playerHolder:"channel_playerHolder_2AGEv",channelContainer:"channel_channelContainer_36niS",content:"channel_content_2ZIju",scheduleList:"channel_scheduleList_34JNq",channels:"channel_channels_12tTB"}},af6a:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Layout",[s("div",{class:t.$style.wrapper},[t.epgLoaded?s("div",{class:t.$style.playerHolder},[s("StreamPlayer",{key:t.playerUpdated,ref:"StreamPlayer",staticClass:"rtm-skin",attrs:{options:t.options,"only-audio":t.isRadio}})],1):t._e(),s("div",{class:t.$style.channelContainer},[s("div",{class:t.$style.content},[s("header",[s("h4",{class:t.$style.title,attrs:{itemprop:"name"}},[t._v(" "+t._s(t.channel.title)+" ")])]),t.shownPrograms.length>0?s("ul",{class:t.$style.scheduleList},[t._l(t.shownPrograms,(function(e,n){return[s("ScheduleItem",{key:e.id+"-"+t.listUpdated,attrs:{index:n,item:e,open:0===n&&!t.smallScreen}})]}))],2):t._e()])])]),s("div",{class:t.$style.channels},[t.scrollListMenu?s("Stripe",{attrs:{submenu:t.scrollListMenu}}):t._e()],1)])},r=[],i=(s("ddb0"),s("f3f3")),o=s("2f62"),a=s("4d77"),h=s("444f"),l={page(){return{title:this.channel.title,meta:[{name:"description",content:this.channel.title}]}},components:{Layout:h["a"],StreamPlayer:()=>s.e("chunk-f9ea9c2c").then(s.bind(null,"36c7")),Stripe:()=>Promise.all([s.e("chunk-ed8ba156"),s.e("chunk-b44df52a")]).then(s.bind(null,"b77f")),ScheduleItem:()=>s.e("chunk-3b152453").then(s.bind(null,"477a"))},props:{channel:{type:Object,required:!0},server:{type:String,required:!0}},data(){return{options:{autoplay:!1,controls:!0,title:this.channel.title,loop:!1},epgLoaded:!1,timer:null,epgTimer:null,programs:[],shownPrograms:[],listUpdated:null,playerUpdated:null,scrollListMenu:null,pwaMode:Object(a["h"])()}},computed:{poster(){return this.channel.imageUrls&&(this.channel.imageUrls[2]||this.channel.imageUrls[1]||this.channel.imageUrls[0])||""},type(){return this.channel.type},subMenuId(){return this.isRadio?"radiochannels":"tv"},smallScreen(){return screen.width<780},isRadio(){return-1!==this.type.indexOf("radio")}},created(){this.options.poster=this.poster,this.fetchChannelEpg(),this.getLiveChannelsSubmenu()},beforeDestroy(){this.timer&&clearInterval(this.timer),this.epgTimer&&clearInterval(this.epgTimer)},methods:Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(o["b"])("channels",["fetchEpg"])),Object(o["b"])("menus",["fetchMenu"])),{},{fetchChannelEpg(){this.fetchEpg({id:this.channel.id,server:this.server}).then(t=>{this.programs=t,this.countShownPrograms(),this.options.sources=this.mediaSrcs(),this.options.sources.length>0&&(this.options.loop="video/mp4"===this.options.sources[0].type),this.playerUpdated=this.$moment().valueOf(),this.epgLoaded=!0,this.timer=setInterval(this.runScheduleUpdate,3e4),this.epgTimer=setInterval(this.runDataRefetch,6e4)})},mediaSrcs(){const t=[],e=[],s=this.getCurrentProgram();if(s&&s.mediaUrls.length>0){for(const e of s.mediaUrls)""!==e&&t.push({type:Object(a["e"])(e),src:e,withCredentials:!1});t.sort((t,e)=>Object(a["e"])(t.src)>Object(a["e"])(e.src)?-1:Object(a["e"])(e.src)>Object(a["e"])(t.src)?1:0)}if(this.channel.streamUrls){for(const s of this.channel.streamUrls)(0===t.length&&"mp4"===s.type||"hls"===s.type||"dash"===s.type||"website"===s.type&&!this.pwaMode||"ottAndroid"===s.type&&this.pwaMode)&&e.push({type:Object(a["e"])(s.url),src:s.url,withCredentials:!1});e.sort((t,e)=>Object(a["e"])(t.src)>Object(a["e"])(e.src)?-1:Object(a["e"])(e.src)>Object(a["e"])(t.src)?1:0)}return[...t,...e]},countShownPrograms(){let t=this.getCurrentProgramIndex();if(-1===t){const e=this.getNextProgramIndex();t=e>-1?e:t}if(t>-1){const e=[];let s=null;this.programs[t]&&(e.push(this.programs[t]),s=this.programs[t]),this.programs[t+1]&&e.push(this.programs[t+1]),this.shownPrograms=e,s&&s.restrictions?this.options.restrictions=this.hasGeoBlocking(s)?s.restrictions:[]:this.options.restrictions&&this.options.restrictions.length>0&&(this.options.restrictions=[])}this.listUpdated=this.$moment().valueOf()},getNextProgramIndex(){return this.programs.findIndex(t=>{const e=this.$moment(t.start);return e.isAfter()})},getCurrentProgramIndex(){return this.programs.findIndex(t=>{const e=this.$moment(t.start),s=this.$moment(t.end);return s.isAfter()&&e.isBefore()})},getCurrentProgram(){const t=this.getCurrentProgramIndex();return-1===t?null:this.programs[t]},getLiveChannelsSubmenu(){this.fetchMenu({menu:this.subMenuId}).then(t=>{this.scrollListMenu=t.items.find(t=>t.type===this.type)})},hasGeoBlocking(t){return Object.prototype.hasOwnProperty.call(t,"restrictions")&&Array.isArray(t.restrictions)&&t.restrictions.length>0},runScheduleUpdate(){const t=this.options.restrictions?[...this.options.restrictions]:[];this.countShownPrograms();const e=this.hasSourcesChanged()||this.hasRestrictionsChanged(t);e&&(this.options.sources=this.mediaSrcs(),this.options.sources.length>0&&(this.options.loop="video/mp4"===this.options.sources[0].type),this.options.autoplay=this.$refs.StreamPlayer.isPlaying(),this.playerUpdated=this.$moment().valueOf())},hasSourcesChanged(){const t=this.mediaSrcs();return!this.options.sources&&t.length>0||(t.length!==this.options.sources.length||JSON.stringify(t)!==JSON.stringify(this.options.sources))},hasRestrictionsChanged(t){return!!(0===t.length&&this.options.restrictions&&this.options.restrictions.length>0)||((!this.options.restrictions||0===this.options.restrictions.length)&&t.length>0||!(!this.options.restrictions&&0===t.length)&&JSON.stringify(t)!==JSON.stringify(this.options.restrictions))},runDataRefetch(){this.fetchEpg({id:this.channel.id,server:this.server}).then(t=>{this.programs=t})}})},c=l,p=s("5aac"),u=s("2877");function d(t){this["$style"]=p["default"].locals||p["default"]}var m=Object(u["a"])(c,n,r,!1,d,null,null);e["default"]=m.exports}}]);
//# sourceMappingURL=chunk-1d686bb0.3196ea9f.js.map